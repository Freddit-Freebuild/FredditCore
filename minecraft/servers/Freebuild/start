#!/bin/bash

cd "$(dirname "$0")"

server_name="FREEBUILD"

cp -r ../shared/configs/plugins .

discordsrv_token=$(grep "{$server_name}_TOKEN=" file.txt | sed 's/^.*=//')
discordsrv_channel=$(grep "{$server_name}_CHANNEL=" file.txt | sed 's/^.*=//')
discordsrv_console_channel=$(grep "{$server_name}_CONSOLE_CHANNEL=" file.txt | sed 's/^.*=//')
discordsrv_discord_invite=$(grep "{$server_name}_DISCORD_INVITE=" file.txt | sed 's/^.*=//')

sed -i "s/BotToken: \"\"/BotToken: \"$discordsrv_token\"/" ./plugins/DiscordSRV/config.yml
sed -i "s/Channels: {\"global\": \"\"}/Channels: {\"global\": \"$discordsrv_channel\"}/" ./plugins/DiscordSRV/config.yml
sed -i "s/DiscordConsoleChannelId: \"\"/DiscordConsoleChannelId: \"$discordsrv_console_channel\"/" ./plugins/DiscordSRV/config.yml
sed -i "s/DiscordInviteLink: \"\"/DiscordInviteLink: \"$discordsrv_discord_invite\"/" ./plugins/DiscordSRV/config.yml

paper=$(ls -t paper-*.jar | head -n 1)

min_mem="4G"
max_mem="8G"

java -Xms$min_mem -Xmx$max_mem -jar $paper nogui --world-container worlds